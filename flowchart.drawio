<mxfile host="app.diagrams.net">
  <diagram name="ESP32 Telegram Relay Flow">
    <mxGraphModel dx="1350" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="1169">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- START -->
        <mxCell id="start" value="Start Program" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" vertex="1" parent="1">
          <mxGeometry x="700" y="20" width="140" height="60" as="geometry"/>
        </mxCell>

        <!-- INIT -->
        <mxCell id="init" value="Initialize Pins&#10;DHT22 Sensor&#10;Relay OFF" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="650" y="120" width="240" height="90" as="geometry"/>
        </mxCell>

        <!-- WIFI -->
        <mxCell id="wifi" value="Connect to WiFi" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="650" y="240" width="240" height="70" as="geometry"/>
        </mxCell>

        <!-- NTP -->
        <mxCell id="ntp" value="Sync Time (NTP)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="650" y="340" width="240" height="70" as="geometry"/>
        </mxCell>

        <!-- LOOP -->
        <mxCell id="loop" value="Main Loop (Every 5s)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;" vertex="1" parent="1">
          <mxGeometry x="650" y="440" width="240" height="70" as="geometry"/>
        </mxCell>

        <!-- READ -->
        <mxCell id="read" value="Read Temperature &amp; Humidity" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="650" y="540" width="240" height="70" as="geometry"/>
        </mxCell>

        <!-- DECISION -->
        <mxCell id="decision" value="Temp ≥ 30°C ?" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="690" y="640" width="160" height="100" as="geometry"/>
        </mxCell>

        <!-- ALERT -->
        <mxCell id="alert" value="Relay OFF?&#10;Send Alert to Telegram&#10;Every Loop" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;" vertex="1" parent="1">
          <mxGeometry x="950" y="640" width="260" height="100" as="geometry"/>
        </mxCell>

        <!-- AUTO OFF -->
        <mxCell id="autooff" value="Temp &lt; 30°C&#10;Relay ON?&#10;Auto OFF + Notify Once" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;" vertex="1" parent="1">
          <mxGeometry x="350" y="640" width="260" height="100" as="geometry"/>
        </mxCell>

        <!-- TELEGRAM -->
        <mxCell id="telegram" value="Check Telegram Updates" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="650" y="780" width="240" height="70" as="geometry"/>
        </mxCell>

        <!-- COMMANDS -->
        <mxCell id="commands" value="Command?&#10;/status → Send Status&#10;/on → Relay ON, Stop Alerts&#10;/off → Relay OFF" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;" vertex="1" parent="1">
          <mxGeometry x="650" y="880" width="360" height="120" as="geometry"/>
        </mxCell>

        <!-- ERROR -->
        <mxCell id="error" value="Exception?&#10;Wait 3s &amp; Retry Loop" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;" vertex="1" parent="1">
          <mxGeometry x="1050" y="440" width="260" height="80" as="geometry"/>
        </mxCell>

        <!-- CONNECTORS -->
        <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="start" target="init"/>
        <mxCell id="e2" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="init" target="wifi"/>
        <mxCell id="e3" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="wifi" target="ntp"/>
        <mxCell id="e4" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="ntp" target="loop"/>
        <mxCell id="e5" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="loop" target="read"/>
        <mxCell id="e6" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="read" target="decision"/>

        <mxCell id="e7" value="YES" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="decision" target="alert"/>
        <mxCell id="e8" value="NO" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="decision" target="autooff"/>

        <mxCell id="e9" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="alert" target="telegram"/>
        <mxCell id="e10" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="autooff" target="telegram"/>
        <mxCell id="e11" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="telegram" target="commands"/>
        <mxCell id="e12" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;" edge="1" parent="1" source="commands" target="loop"/>

        <mxCell id="e13" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;dashed=1;" edge="1" parent="1" source="loop" target="error"/>
        <mxCell id="e14" style="edgeStyle=orthogonalEdgeStyle;endArrow=block;dashed=1;" edge="1" parent="1" source="error" target="loop"/>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
